<%- include('partials/header', { title: 'Year Content Management' }) %>

<!-- Admin Layout -->
<div class="admin-layout">
    <%- include('partials/sidebar') %>
    
    <!-- Main Content -->
    <main class="admin-main-content">
        <%- include('partials/header-bar', { title: 'Year Content Management' }) %>
        
        <!-- Content Area -->
        <div class="admin-content">
            <!-- Page Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="admin-card" data-aos="fade-up">
                        <div class="admin-card-header">
                            <div>
                                <h2 class="admin-card-title">Year Content Management</h2>
                                <p class="text-muted mb-0">Manage content descriptions and features for each year level.</p>
                            </div>
                            <div>
                                <button class="admin-btn primary" onclick="openCreateYearContentModal()">
                                    <i class="fas fa-plus"></i>
                                    Add Year Content
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Year Content Cards -->
            <div class="row">
                <% if (yearContent && yearContent.length > 0) { %>
                    <% yearContent.forEach(content => { %>
                        <div class="col-md-6 col-lg-4 mb-4" data-aos="fade-up" data-aos-delay="<%= content.year === 'Year 8' ? '100' : content.year === 'Year 9' ? '200' : '300' %>">
                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <div class="admin-card-icon">
                                        <i class="<%= content.icon || 'fas fa-book' %>"></i>
                                    </div>
                                    <div>
                                        <h3 class="admin-card-title"><%= content.year %></h3>
                                        <p class="text-muted mb-0"><%= content.curriculum %> - <%= content.studentType %></p>
                                    </div>
                                </div>
                                <div class="admin-card-body">
                                    <h4 class="admin-card-subtitle"><%= content.title %></h4>
                                    <p class="admin-card-description"><%= content.description %></p>
                                    
                                    <div class="admin-features-list">
                                        <h5>Features:</h5>
                                        <div class="admin-tags">
                                            <% content.features.forEach(feature => { %>
                                                <span class="admin-tag"><%= feature %></span>
                                            <% }); %>
                                        </div>
                                    </div>

                                    <div class="admin-stats-row">
                                        <div class="admin-stat">
                                            <span class="admin-stat-number"><%= content.topics ? content.topics.length : 0 %></span>
                                            <span class="admin-stat-label">Topics</span>
                                        </div>
                                        <div class="admin-stat">
                                            <span class="admin-stat-number"><%= content.learningObjectives ? content.learningObjectives.length : 0 %></span>
                                            <span class="admin-stat-label">Objectives</span>
                                        </div>
                                        <div class="admin-stat">
                                            <span class="admin-stat-number"><%= content.resources ? content.resources.length : 0 %></span>
                                            <span class="admin-stat-label">Resources</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="admin-card-footer">
                                    <div class="admin-card-actions">
                                        <button class="admin-btn-icon" onclick="viewYearContent('<%= content._id %>')" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="admin-btn-icon" onclick="editYearContent('<%= content._id %>')" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="admin-btn-icon danger" onclick="deleteYearContent('<%= content._id %>')" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="col-12">
                        <div class="admin-card" data-aos="fade-up">
                            <div class="admin-card-body text-center py-5">
                                <div class="admin-empty-state">
                                    <i class="fas fa-book"></i>
                                    <h4>No Year Content Found</h4>
                                    <p>Start by adding content for each year level.</p>
                                    <button class="admin-btn primary" onclick="openCreateYearContentModal()">
                                        <i class="fas fa-plus"></i>
                                        Add Year Content
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </main>
</div>

<!-- Create Year Content Modal -->
<div class="admin-modal" id="createYearContentModal">
    <div class="admin-modal-content">
        <div class="admin-modal-header">
            <h3 class="admin-modal-title">Create Year Content</h3>
            <button class="admin-modal-close" onclick="closeCreateYearContentModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="createYearContentForm">
            <div class="admin-modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Year *</label>
                            <select class="admin-form-input" name="year" required>
                                <option value="">Select Year</option>
                                <option value="Year 8">Year 8</option>
                                <option value="Year 9">Year 9</option>
                                <option value="Year 10">Year 10</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Title *</label>
                            <input type="text" class="admin-form-input" name="title" required>
                        </div>
                    </div>
                </div>

                <div class="admin-form-group">
                    <label class="admin-form-label">Description *</label>
                    <textarea class="admin-form-input" name="description" rows="3" required></textarea>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Icon *</label>
                            <input type="text" class="admin-form-input" name="icon" value="fas fa-book" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Curriculum *</label>
                            <select class="admin-form-input" name="curriculum" required>
                                <option value="">Select Curriculum</option>
                                <option value="Cambridge">Cambridge</option>
                                <option value="Edexcel">Edexcel</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Student Type *</label>
                            <select class="admin-form-input" name="studentType" required>
                                <option value="">Select Type</option>
                                <option value="School">School</option>
                                <option value="Center">Center</option>
                                <option value="Online">Online</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="admin-form-group">
                    <label class="admin-form-label">Features (comma-separated)</label>
                    <input type="text" class="admin-form-input" name="features" placeholder="Algebra Basics, Geometry, Statistics">
                </div>

                <div class="admin-form-group">
                    <label class="admin-form-label">Prerequisites (comma-separated)</label>
                    <input type="text" class="admin-form-input" name="prerequisites" placeholder="Basic arithmetic, Number theory">
                </div>
            </div>
            <div class="admin-modal-footer">
                <button type="button" class="admin-btn secondary" onclick="closeCreateYearContentModal()">Cancel</button>
                <button type="submit" class="admin-btn primary">Create Year Content</button>
            </div>
        </form>
    </div>
</div>

<%- include('partials/footer') %>

<script>
// Year Content Management Functions
function openCreateYearContentModal() {
    document.getElementById('createYearContentModal').style.display = 'flex';
}

function closeCreateYearContentModal() {
    document.getElementById('createYearContentModal').style.display = 'none';
    document.getElementById('createYearContentForm').reset();
}

// Handle form submission
document.getElementById('createYearContentForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    try {
        const response = await fetch('/admin/year-content/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showNotification('Year content created successfully!', 'success');
            closeCreateYearContentModal();
            location.reload();
        } else {
            showNotification(result.message || 'Error creating year content', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('Error creating year content', 'error');
    }
});

function viewYearContent(contentId) {
    // Implementation for viewing year content details
    console.log('View year content:', contentId);
}

function editYearContent(contentId) {
    // Implementation for editing year content
    console.log('Edit year content:', contentId);
}

function deleteYearContent(contentId) {
    if (confirm('Are you sure you want to delete this year content?')) {
        // Implementation for deleting year content
        console.log('Delete year content:', contentId);
    }
}
</script>
