<%- include('../partials/header') %>

<!-- Flash Messages - Floating from left below navbar -->
<% if (typeof error_msg !== 'undefined' && error_msg.length > 0) { %>
<div class="floating-flash-message error-flash" style="position: fixed; top: 90px; left: 20px; z-index: 1200; max-width: 400px; animation: slideInLeft 0.5s ease-out;">
  <div class="alert alert-warning alert-dismissible fade show" role="alert">
    <div class="d-flex align-items-center">
      <i class="fas fa-info-circle me-2"></i>
      <strong>Notice:</strong>
    </div>
    <hr class="my-2">
    <p class="mb-0"><%= error_msg %></p>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
</div>
<% } %>

<% if (typeof success_msg !== 'undefined' && success_msg.length > 0) { %>
<div class="floating-flash-message success-flash" style="position: fixed; top: 90px; left: 20px; z-index: 1200; max-width: 400px; animation: slideInLeft 0.5s ease-out;">
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <div class="d-flex align-items-center">
      <i class="fas fa-check-circle me-2"></i>
      <strong>Success!</strong>
    </div>
    <hr class="my-2">
    <p class="mb-0"><%= success_msg %></p>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
</div>
<% } %>

<div class="auth-container math-auth-bg" data-aos="fade">
  <div class="auth-background"></div>
  <div class="auth-particles" id="auth-particles"></div>
  <div class="math-shape-auth auth-shape1 floating-element"></div>
  <div class="math-shape-auth auth-shape2 floating-element"></div>
  <div class="math-shape-auth auth-shape3 floating-element"></div>
  <div class="math-shape-auth auth-shape4 floating-element"></div>

  <!-- Removed duplicate floating theme toggle to avoid conflicts with navbar toggle -->

  <div class="container">
    <div class="card auth-card mx-auto" data-aos="fade-up" data-aos-delay="200">
      <div class="card-body p-4 p-md-5">
        <div class="auth-header">
          <div class="auth-icon-container">
            <i class="fas fa-calculator math-icon-animated"></i>
          </div>
          <h2><i class="fas fa-sign-in-alt me-2"></i> Math Explorer Login</h2>
          <p>Ready for your math adventure?</p>
        </div>

        <!-- Display Errors -->
        <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
        <div class="alert alert-danger" role="alert" style="position: relative; z-index: 1100; margin-bottom: 20px;">
          <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Login Failed!</strong>
          </div>
          <hr class="my-2">
          <ul class="mb-0">
            <% errors.forEach(function(error) { %>
            <li><%= error.msg %></li>
            <% }); %>
          </ul>
        </div>
        <% } %>

        <form action="/auth/login" method="POST" class="auth-form needs-validation" novalidate>
          <div class="mb-4">
            <label for="email" class="form-label">Email Address or Phone Number</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-user"></i></span>
              <input type="text" id="email" name="email" class="form-control" placeholder="Enter your email or phone number" value="<%= typeof email != 'undefined' ? email : '' %>" required>
              <div class="invalid-feedback">
                Please enter your email or phone number.
              </div>
            </div>
            <div class="form-text">You can login with either your email address or student phone number.</div>
          </div>

          <div class="mb-4">
            <label for="password" class="form-label">Password</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-lock"></i></span>
              <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password" required>
              <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                <i class="fas fa-eye"></i>
              </button>
              <div class="invalid-feedback">
                Please enter your password.
              </div>
            </div>
          </div>

          <div class="mb-4 form-check">
            <input type="checkbox" class="form-check-input" id="rememberMe" name="rememberMe">
            <label class="form-check-label" for="rememberMe">Remember me</label>
            <a href="#" class="float-end">Forgot Password?</a>
          </div>

          <div class="d-grid" data-aos="fade-up" data-aos-delay="300">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="fas fa-sign-in-alt me-2"></i> Login
            </button>
          </div>
        </form>


        <div class="auth-footer" data-aos="fade-up" data-aos-delay="450">
          <p>Don't have an account? <a href="/auth/register" class="animated-link">Register Now</a></p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Auth Common JavaScript -->
<script src="/js/auth-common.js"></script>

<!-- Auth Animations -->
<script src="/js/auth-animations.js"></script>

<%- include('../partials/footer') %>